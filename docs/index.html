<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Util GDE</title>

<!-- Bootswatch Darkly -->
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/darkly/bootstrap.min.css">

<!-- JSONEditor -->
<script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.min.js"></script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<style>
    body {
        background: #1a1c1e;
    }
    #editorPanel {
        max-width: 900px;
        margin: 20px auto;
    }
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="#">Util GDE</a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navContent">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navContent">
      <ul class="navbar-nav me-auto">

        <!-- SelecciÃ³n del schema -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="schemaMenu" role="button" data-bs-toggle="dropdown">
            Schemas
          </a>
          <ul class="dropdown-menu" id="schemaList">
            <!-- Se llenarÃ¡ por JS -->
          </ul>
        </li>

      </ul>

      <!-- Botones -->
      <div class="d-flex">
        <button id="btnDownload" class="btn btn-info me-2">ðŸ“¥ Descargar</button>
        <button id="btnReset" class="btn btn-danger">â™» Resetear</button>
      </div>

    </div>
  </div>
</nav>


<!-- PANEL DEL EDITOR -->
<div id="editorPanel" class="card border-primary bg-dark text-light shadow">
    <div class="card-header bg-primary text-white fw-bold">
        Editando <span id="currentSchemaName"></span>
    </div>

    <div id="editorHolder" class="card-body bg-light text-dark" style="min-height:300px;">
        <!-- JSON Editor se monta aquÃ­ -->
    </div>
</div>


<script>
/*******************************************************
 * 1) DefiniciÃ³n de mÃºltiples schemas
 *******************************************************/
const schemas = {
    perfil: {
        title: "Perfil",
        type: "object",
        properties: {
            nombre: { type: "string" },
            edad: { type: "number" },
            activo: { type: "boolean" },
            notas: { type: "string" }
        }
    },

    direccion: {
        title: "DirecciÃ³n",
        type: "object",
        properties: {
            calle: { type: "string" },
            numero: { type: "number" },
            ciudad: { type: "string" },
            pais: { type: "string" }
        }
    },

    configuracion: {
        title: "ConfiguraciÃ³n",
        type: "object",
        properties: {
            tema: {
                type: "string",
                enum: ["claro", "oscuro", "sistema"]
            },
            notificaciones: { type: "boolean" },
            refresco: {
                type: "number",
                description: "Tiempo en segundos"
            }
        }
    }
};

/*******************************************************
 * 2) Rellenar el menÃº de schemas dinÃ¡micamente
 *******************************************************/
const schemaList = document.getElementById("schemaList");

Object.keys(schemas).forEach(key => {
    const li = document.createElement("li");
    const a = document.createElement("a");
    a.className = "dropdown-item";
    a.href = "#";
    a.textContent = key;
    a.onclick = () => loadSchema(key);
    li.appendChild(a);
    schemaList.appendChild(li);
});


/*******************************************************
 * 3) Variables del editor
 *******************************************************/
let editor = null;
let currentSchemaKey = null;
JSONEditor.defaults.options.iconlib = "fontawesome5";
JSONEditor.defaults.options.theme = "bootstrap5";
JSONEditor.defaults.options.disable_edit_json = true;
JSONEditor.defaults.options.disable_properties = true;
JSONEditor.defaults.options.display_required_only = false;
/*******************************************************
 * 4) Cargar schema con persistencia por clave
 *******************************************************/
function loadSchema(key) {
    currentSchemaKey = key;
    document.getElementById("currentSchemaName").textContent = key;

    // Recuperar datos guardados
    const raw = localStorage.getItem("jsonEditorData_" + key);
    let startval = null;
    if (raw) {
        try { startval = JSON.parse(raw); }
        catch { startval = null; }
    }

    // Destruir editor previo
    if (editor) {
        editor.destroy();
        editor = null;
    }

    // Crear editor nuevo
    editor = new JSONEditor(document.getElementById("editorHolder"), {
        schema: schemas[key],
        startval: startval ?? undefined,
        required_by_default : true
        });

    // Guardado automÃ¡tico
    editor.on("change", () => {
        localStorage.setItem(
            "jsonEditorData_" + key,
            JSON.stringify(editor.getValue())
        );
    });
}


/*******************************************************
 * 5) BotÃ³n Descargar
 *******************************************************/
document.getElementById("btnDownload").onclick = () => {
    if (!editor) return;

    const data = editor.getValue();
    const blob = new Blob([JSON.stringify(data, null, 2)], {
        type: "application/json"
    });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = currentSchemaKey + ".json";
    a.click();
    URL.revokeObjectURL(url);
};


/*******************************************************
 * 6) BotÃ³n Reset
 *******************************************************/
document.getElementById("btnReset").onclick = () => {
    if (!currentSchemaKey || !editor) return;

    if (confirm("Â¿Seguro que deseas borrar los datos del schema '" + currentSchemaKey + "'?")) {
        localStorage.removeItem("jsonEditorData_" + currentSchemaKey);
        editor.setValue({});
    }
};


/*******************************************************
 * 7) Cargar el primer schema automÃ¡ticamente
 *******************************************************/
loadSchema(Object.keys(schemas)[0]);
</script>

</body>
</html>
